import{p as G,k as J,r as x,o as t}from"./index-2e94f979.js";import{H as K}from"./Header-48e62de2.js";import{B as b}from"./button.esm-68dda0e7.js";const U=()=>{var C,P,T,I,R,E,H,W,$,A,D;const v=G(),{state:s}=J(),k=x.useRef(null),w=x.useRef([]),p=x.useRef(null),[u,S]=x.useState("full"),Y=()=>{p.current&&(p.current.scrollLeft-=200)},_=()=>{p.current&&(p.current.scrollLeft+=200)};x.useEffect(()=>{var i;const l=k.current,e=l==null?void 0:l.getContext("2d");if(e){e.clearRect(0,0,l==null?void 0:l.width,l==null?void 0:l.height);const a=new Image;a.src=(i=s==null?void 0:s.imageSelected)==null?void 0:i.url,a.onload=()=>{var y;const r=a.width,o=a.height,n=l.width,d=o/r*n;l.width=n,l.height=d,e==null||e.clearRect(0,0,n,d),e==null||e.drawImage(a,0,0,n,d),(y=s.polygons)==null||y.forEach(c=>{const m=new Path2D,[h,...f]=c.points;m.moveTo(h.x,h.y),f.forEach(g=>{m.lineTo(g.x,g.y)}),m.closePath(),e.strokeStyle=c.color,e.lineWidth=2,e.fillStyle=`${c.color}60`,e.fill(m);const B=c.points.reduce((g,N)=>g+N.x,0)/c.points.length,L=c.points.reduce((g,N)=>g+N.y,0)/c.points.length;e.fillStyle="white";const j=4,q=e.measureText(c.label).width+5,X=14;e.fillRect(B-q/2-j,L-X/2-j,q+2*j,X+1*j),e.fillStyle="black",e.font="12px Arial",e.textAlign="center",e.textBaseline="middle",e.fillText(c.label,B,L),e.stroke(m)})}}},[s.polygons,(C=s==null?void 0:s.imageSelected)==null?void 0:C.url]);const z=(l,e,i,a)=>{l.imageSmoothingEnabled=!0;const r=new Path2D,[o,...n]=e.points;r.moveTo(o.x-i,o.y-a),n.forEach(d=>{r.lineTo(d.x-i,d.y-a)}),r.closePath(),l.strokeStyle=e.color,l.lineWidth=2.5,l.fillStyle=`${e.color}50`,l.fill(r),l.stroke(r)},F=(l,e,i)=>{const a=new Path2D,[r,...o]=e.points;a.moveTo(r.x*i,r.y*i),o.forEach(n=>{a.lineTo(n.x*i,n.y*i)}),a.closePath(),l.strokeStyle=e.color,l.lineWidth=2,l.fillStyle=`${e.color}60`,l.fill(a),l.stroke(a)};return x.useEffect(()=>{const l=()=>{var e;(e=w==null?void 0:w.current)==null||e.forEach((i,a)=>{if(i){const r=i.getContext("2d");if(r){const o=s.polygons[a],n=new Image;n.src=s.imageSelected.url,n.onload=()=>{const d=n.width,y=n.height,c=i.width,m=y/d*c;let h,f;o.bbox&&u==="cropped"?(console.log(99),h=o.bbox[2]-o.bbox[0],f=o.bbox[3]-o.bbox[1],i.width=h,i.height=f,r.clearRect(0,0,h,f),r.drawImage(n,o.bbox[0],o.bbox[1],h,f,0,0,h,f),z(r,o,o==null?void 0:o.bbox[0],o==null?void 0:o.bbox[1])):(i.width=c,i.height=m,r.clearRect(0,0,c,m),r.drawImage(n,0,0,c,m),F(r,o,d/c))},n.onerror=d=>{console.error("Image load error:",d)}}else requestAnimationFrame(l)}})};l()},[u]),t.jsxs("div",{className:"w-screen h-[100dvh] relative flex flex-col bg-ochre",children:[t.jsx(K,{}),t.jsx("div",{className:"customScrollbar h-full py-3 px-1 sm:px-3 my-3 mx-0 sm:mx-3 flex flex-col justify-around items-center bg-metallic-brown rounded-lg shadow-md overflow-y-auto",children:t.jsxs("div",{className:"w-full h-full flex flex-col gap-y-3 md:gap-y-5 overflow-y-auto",children:[t.jsxs("div",{className:"px-2 md:px-0 flex justify-between items-center",children:[t.jsxs("div",{className:"flex flex-col gap-1",children:[t.jsx("span",{className:"text-lg md:text-xl font-medium text-naples-yellow",children:"Annotations on Cropped Image"}),t.jsx("span",{className:"text-sm md:text-base text-bud-green font-medium",children:"Individual annotations on cropped image"})]}),t.jsx("div",{className:"hidden md:flex flex-row gap-x-10",children:t.jsx(b,{disabled:((T=(P=s==null?void 0:s.imageSelected)==null?void 0:P.url)==null?void 0:T.length)<=0||((I=s.polygons)==null?void 0:I.length)<1,icon:"pi pi-check",label:"Continue",className:"h-10 text-metallic-brown bg-naples-yellow border-naples-yellow",onClick:()=>{x.startTransition(()=>{v("/preview")})}})})]}),t.jsxs("div",{className:"w-full h-full flex flex-col md:flex-row gap-2",children:[t.jsx("div",{className:"w-full md:w-2/4 lg:w-2/5 h-fit md:mb-0 mx-auto",children:t.jsx("div",{className:"w-fit h-fit m-auto border-2 border-ochre rounded-lg",children:t.jsx("canvas",{className:"mx-auto rounded-lg",ref:k})})}),t.jsx("div",{className:"w-full md:w-2/4 lg:w-3/5",children:t.jsxs("div",{className:"w-full p-3 rounded-xl bg-fern-green",children:[t.jsxs("div",{className:"flex justify-between items-center text-base text-blue-900 pb-2",children:[t.jsxs("span",{className:"text-base sm:text-lg text-naples-yellow font-semibold",children:["Annotations on"," ",u==="cropped"?"cropped image":"full image"," (",((R=s.polygons)==null?void 0:R.length)<10?`0${(E=s.polygons)==null?void 0:E.length}`:`${(H=s.polygons)==null?void 0:H.length}`,")"]}),t.jsx(b,{disabled:s.imageSelected.url==="",icon:"pi pi-images",label:`${u==="cropped"?"Cropped Image":"Full Image"}`,title:"change orientation",className:"h-10 px-2 md:px-5 text-xs sm:text-sm text-naples-yellow border-2 border-naples-yellow bg-transparent",onClick:()=>{S(u==="full"?"cropped":"full")}})]}),t.jsxs("div",{className:"mt-2 relative",children:[t.jsx("div",{className:"customCarouselScrollbar w-full h-full flex justify-start items-center overflow-x-auto",ref:p,children:(W=s.polygons)==null?void 0:W.map((l,e)=>t.jsx("div",{title:"Click to open eedback dialog box",className:"w-fit h-full p-2 flex flex-col items-center justify-center gap-y-2 bg-bud-green rounded-lg mr-2",children:t.jsx("div",{className:"w-fit flex items-center",style:{height:"calc(100% - 2.5rem)"},children:t.jsx("canvas",{className:" mx-auto rounded-lg",ref:i=>w.current[e]=i,width:200,style:{maxHeight:"250px",height:"250px"}})})},e))}),t.jsx(b,{icon:"pi pi-angle-left ",title:"scroll-left",className:"!w-[30px] !h-[30px] rounded-full border-0 bg-naples-yellow text-fern-green absolute -left-2 top-[45%] shadow-md",onClick:()=>Y()}),t.jsx(b,{icon:"pi pi-angle-right",title:"scroll-right",className:"!w-[30px] !h-[30px] rounded-full border-0 bg-naples-yellow text-fern-green absolute -right-2 top-[45%] shadow-md",onClick:()=>_()})]})]})})]})]})}),t.jsx("div",{className:"w-full p-2 flex md:hidden flex-col items-center sticky bottom-0 left-0 right-0 bg-metallic-brown rounded-t-3xl text-xs",children:t.jsx("div",{className:"flex flex-row gap-x-10",children:t.jsx(b,{disabled:((A=($=s==null?void 0:s.imageSelected)==null?void 0:$.url)==null?void 0:A.length)<=0||((D=s.polygons)==null?void 0:D.length)<1,icon:"pi pi-check",label:"Continue",className:"h-10 text-metallic-brown bg-naples-yellow border-naples-yellow",onClick:()=>{x.startTransition(()=>{v("/preview")})}})})})]})};export{U as default};
